import { requestUrl } from 'obsidian';
export class OllamaEmbeddingProvider {
    constructor(app, baseUrl = 'http://127.0.0.1:11434', model = 'nomic-embed-text') {
        this.app = app;
        this.baseUrl = baseUrl;
        this.model = model;
    }
    async isAvailable() {
        try {
            const res = await requestUrl({ url: `${this.baseUrl}/api/tags`, method: 'GET' });
            return res.status === 200;
        }
        catch (e) {
            console.warn("[Ollama] Not detected. Ensure 'ollama serve' is running.");
            return false;
        }
    }
    /**
     * Check if a specific model is present in the local Ollama registry.
     */
    async hasModel(modelName = this.model) {
        try {
            const res = await requestUrl({ url: `${this.baseUrl}/api/tags`, method: 'GET' });
            if (res.status !== 200)
                return false;
            const tags = res.json?.models || res.json?.modelsList || res.json?.data;
            if (Array.isArray(tags)) {
                return tags.some((m) => m?.name === modelName || m?.model === modelName || m === modelName);
            }
            return false;
        }
        catch {
            return false;
        }
    }
    async getEmbedding(text) {
        const res = await requestUrl({
            url: `${this.baseUrl}/api/embed`,
            method: 'POST',
            body: JSON.stringify({
                model: this.model,
                input: text
            })
        });
        const vec = res.json?.embeddings?.[0];
        if (!Array.isArray(vec) || vec.length === 0) {
            throw new Error('[Ollama] Invalid embedding response');
        }
        return vec;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2xsYW1hRW1iZWRkaW5nUHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJPbGxhbWFFbWJlZGRpbmdQcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQU8sVUFBVSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRTNDLE1BQU0sT0FBTyx1QkFBdUI7SUFLbkMsWUFBWSxHQUFRLEVBQUUsT0FBTyxHQUFHLHdCQUF3QixFQUFFLEtBQUssR0FBRyxrQkFBa0I7UUFDbkYsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFDZixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBRUQsS0FBSyxDQUFDLFdBQVc7UUFDaEIsSUFBSSxDQUFDO1lBQ0osTUFBTSxHQUFHLEdBQUcsTUFBTSxVQUFVLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsT0FBTyxXQUFXLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDakYsT0FBTyxHQUFHLENBQUMsTUFBTSxLQUFLLEdBQUcsQ0FBQztRQUMzQixDQUFDO1FBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUNaLE9BQU8sQ0FBQyxJQUFJLENBQUMsMERBQTBELENBQUMsQ0FBQztZQUN6RSxPQUFPLEtBQUssQ0FBQztRQUNkLENBQUM7SUFDRixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsUUFBUSxDQUFDLFlBQW9CLElBQUksQ0FBQyxLQUFLO1FBQzVDLElBQUksQ0FBQztZQUNKLE1BQU0sR0FBRyxHQUFHLE1BQU0sVUFBVSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sV0FBVyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2pGLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxHQUFHO2dCQUFFLE9BQU8sS0FBSyxDQUFDO1lBQ3JDLE1BQU0sSUFBSSxHQUFJLEdBQUcsQ0FBQyxJQUFZLEVBQUUsTUFBTSxJQUFLLEdBQUcsQ0FBQyxJQUFZLEVBQUUsVUFBVSxJQUFLLEdBQUcsQ0FBQyxJQUFZLEVBQUUsSUFBSSxDQUFDO1lBQ25HLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUN6QixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLEtBQUssU0FBUyxJQUFJLENBQUMsRUFBRSxLQUFLLEtBQUssU0FBUyxJQUFJLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQztZQUNsRyxDQUFDO1lBQ0QsT0FBTyxLQUFLLENBQUM7UUFDZCxDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1IsT0FBTyxLQUFLLENBQUM7UUFDZCxDQUFDO0lBQ0YsQ0FBQztJQUVELEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBWTtRQUM5QixNQUFNLEdBQUcsR0FBRyxNQUFNLFVBQVUsQ0FBQztZQUM1QixHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsT0FBTyxZQUFZO1lBQ2hDLE1BQU0sRUFBRSxNQUFNO1lBQ2QsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQ3BCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztnQkFDakIsS0FBSyxFQUFFLElBQUk7YUFDWCxDQUFDO1NBQ0YsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxHQUFHLEdBQUksR0FBRyxDQUFDLElBQVksRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQzdDLE1BQU0sSUFBSSxLQUFLLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUN4RCxDQUFDO1FBQ0QsT0FBTyxHQUFHLENBQUM7SUFDWixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIHJlcXVlc3RVcmwgfSBmcm9tICdvYnNpZGlhbic7XG5cbmV4cG9ydCBjbGFzcyBPbGxhbWFFbWJlZGRpbmdQcm92aWRlciB7XG5cdHByaXZhdGUgcmVhZG9ubHkgYXBwOiBBcHA7XG5cdHByaXZhdGUgcmVhZG9ubHkgYmFzZVVybDogc3RyaW5nO1xuXHRwcml2YXRlIHJlYWRvbmx5IG1vZGVsOiBzdHJpbmc7XG5cblx0Y29uc3RydWN0b3IoYXBwOiBBcHAsIGJhc2VVcmwgPSAnaHR0cDovLzEyNy4wLjAuMToxMTQzNCcsIG1vZGVsID0gJ25vbWljLWVtYmVkLXRleHQnKSB7XG5cdFx0dGhpcy5hcHAgPSBhcHA7XG5cdFx0dGhpcy5iYXNlVXJsID0gYmFzZVVybDtcblx0XHR0aGlzLm1vZGVsID0gbW9kZWw7XG5cdH1cblxuXHRhc3luYyBpc0F2YWlsYWJsZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdFVybCh7IHVybDogYCR7dGhpcy5iYXNlVXJsfS9hcGkvdGFnc2AsIG1ldGhvZDogJ0dFVCcgfSk7XG5cdFx0XHRyZXR1cm4gcmVzLnN0YXR1cyA9PT0gMjAwO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdGNvbnNvbGUud2FybihcIltPbGxhbWFdIE5vdCBkZXRlY3RlZC4gRW5zdXJlICdvbGxhbWEgc2VydmUnIGlzIHJ1bm5pbmcuXCIpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVjayBpZiBhIHNwZWNpZmljIG1vZGVsIGlzIHByZXNlbnQgaW4gdGhlIGxvY2FsIE9sbGFtYSByZWdpc3RyeS5cblx0ICovXG5cdGFzeW5jIGhhc01vZGVsKG1vZGVsTmFtZTogc3RyaW5nID0gdGhpcy5tb2RlbCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0VXJsKHsgdXJsOiBgJHt0aGlzLmJhc2VVcmx9L2FwaS90YWdzYCwgbWV0aG9kOiAnR0VUJyB9KTtcblx0XHRcdGlmIChyZXMuc3RhdHVzICE9PSAyMDApIHJldHVybiBmYWxzZTtcblx0XHRcdGNvbnN0IHRhZ3MgPSAocmVzLmpzb24gYXMgYW55KT8ubW9kZWxzIHx8IChyZXMuanNvbiBhcyBhbnkpPy5tb2RlbHNMaXN0IHx8IChyZXMuanNvbiBhcyBhbnkpPy5kYXRhO1xuXHRcdFx0aWYgKEFycmF5LmlzQXJyYXkodGFncykpIHtcblx0XHRcdFx0cmV0dXJuIHRhZ3Muc29tZSgobTogYW55KSA9PiBtPy5uYW1lID09PSBtb2RlbE5hbWUgfHwgbT8ubW9kZWwgPT09IG1vZGVsTmFtZSB8fCBtID09PSBtb2RlbE5hbWUpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0gY2F0Y2gge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdGFzeW5jIGdldEVtYmVkZGluZyh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XG5cdFx0Y29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdFVybCh7XG5cdFx0XHR1cmw6IGAke3RoaXMuYmFzZVVybH0vYXBpL2VtYmVkYCxcblx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkoe1xuXHRcdFx0XHRtb2RlbDogdGhpcy5tb2RlbCxcblx0XHRcdFx0aW5wdXQ6IHRleHRcblx0XHRcdH0pXG5cdFx0fSk7XG5cdFx0Y29uc3QgdmVjID0gKHJlcy5qc29uIGFzIGFueSk/LmVtYmVkZGluZ3M/LlswXTtcblx0XHRpZiAoIUFycmF5LmlzQXJyYXkodmVjKSB8fCB2ZWMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1tPbGxhbWFdIEludmFsaWQgZW1iZWRkaW5nIHJlc3BvbnNlJyk7XG5cdFx0fVxuXHRcdHJldHVybiB2ZWM7XG5cdH1cbn1cblxuIl19