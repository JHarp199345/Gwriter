import MarkdownIt from 'markdown-it';
const md = new MarkdownIt({ html: false, linkify: false, typographer: false });
function decodeEntities(s) {
    // Minimal decode for common entities produced by markdown-it.
    return s
        .replace(/&nbsp;/g, ' ')
        .replace(/&amp;/g, '&')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&quot;/g, '"')
        .replace(/&#39;/g, "'");
}
export function markdownToPlainText(markdown) {
    const html = md.render(markdown || '');
    // Strip tags and collapse whitespace. Keep paragraph breaks.
    const withBreaks = html
        .replace(/<\/p>\s*<p>/g, '\n\n')
        .replace(/<br\s*\/?>/g, '\n')
        .replace(/<\/h\d>\s*<h\d[^>]*>/g, '\n\n')
        .replace(/<\/li>\s*<li>/g, '\n')
        .replace(/<\/(ul|ol)>/g, '\n\n');
    const stripped = withBreaks.replace(/<[^>]+>/g, '');
    return decodeEntities(stripped).replace(/\n{3,}/g, '\n\n').trim();
}
export function sliceFirstNWords(text, wordLimit) {
    const limit = Math.max(0, Math.floor(wordLimit));
    if (limit <= 0)
        return '';
    const words = (text || '').trim().split(/\s+/g).filter(Boolean);
    if (words.length <= limit)
        return words.join(' ');
    return words.slice(0, limit).join(' ');
}
export function countWords(text) {
    return (text || '').trim().split(/\s+/g).filter(Boolean).length;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXhwb3J0VGV4dFV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRXhwb3J0VGV4dFV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sVUFBVSxNQUFNLGFBQWEsQ0FBQztBQUVyQyxNQUFNLEVBQUUsR0FBRyxJQUFJLFVBQVUsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztBQUUvRSxTQUFTLGNBQWMsQ0FBQyxDQUFTO0lBQ2hDLDhEQUE4RDtJQUM5RCxPQUFPLENBQUM7U0FDTixPQUFPLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQztTQUN2QixPQUFPLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQztTQUN0QixPQUFPLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQztTQUNyQixPQUFPLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQztTQUNyQixPQUFPLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQztTQUN2QixPQUFPLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQzFCLENBQUM7QUFFRCxNQUFNLFVBQVUsbUJBQW1CLENBQUMsUUFBZ0I7SUFDbkQsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLENBQUM7SUFDdkMsNkRBQTZEO0lBQzdELE1BQU0sVUFBVSxHQUFHLElBQUk7U0FDckIsT0FBTyxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUM7U0FDL0IsT0FBTyxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUM7U0FDNUIsT0FBTyxDQUFDLHVCQUF1QixFQUFFLE1BQU0sQ0FBQztTQUN4QyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDO1NBQy9CLE9BQU8sQ0FBQyxjQUFjLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDbEMsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEQsT0FBTyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNuRSxDQUFDO0FBRUQsTUFBTSxVQUFVLGdCQUFnQixDQUFDLElBQVksRUFBRSxTQUFpQjtJQUMvRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDakQsSUFBSSxLQUFLLElBQUksQ0FBQztRQUFFLE9BQU8sRUFBRSxDQUFDO0lBQzFCLE1BQU0sS0FBSyxHQUFHLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEUsSUFBSSxLQUFLLENBQUMsTUFBTSxJQUFJLEtBQUs7UUFBRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEQsT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUVELE1BQU0sVUFBVSxVQUFVLENBQUMsSUFBWTtJQUN0QyxPQUFPLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDO0FBQ2pFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWFya2Rvd25JdCBmcm9tICdtYXJrZG93bi1pdCc7XHJcblxyXG5jb25zdCBtZCA9IG5ldyBNYXJrZG93bkl0KHsgaHRtbDogZmFsc2UsIGxpbmtpZnk6IGZhbHNlLCB0eXBvZ3JhcGhlcjogZmFsc2UgfSk7XHJcblxyXG5mdW5jdGlvbiBkZWNvZGVFbnRpdGllcyhzOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdC8vIE1pbmltYWwgZGVjb2RlIGZvciBjb21tb24gZW50aXRpZXMgcHJvZHVjZWQgYnkgbWFya2Rvd24taXQuXHJcblx0cmV0dXJuIHNcclxuXHRcdC5yZXBsYWNlKC8mbmJzcDsvZywgJyAnKVxyXG5cdFx0LnJlcGxhY2UoLyZhbXA7L2csICcmJylcclxuXHRcdC5yZXBsYWNlKC8mbHQ7L2csICc8JylcclxuXHRcdC5yZXBsYWNlKC8mZ3Q7L2csICc+JylcclxuXHRcdC5yZXBsYWNlKC8mcXVvdDsvZywgJ1wiJylcclxuXHRcdC5yZXBsYWNlKC8mIzM5Oy9nLCBcIidcIik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtYXJrZG93blRvUGxhaW5UZXh0KG1hcmtkb3duOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdGNvbnN0IGh0bWwgPSBtZC5yZW5kZXIobWFya2Rvd24gfHwgJycpO1xyXG5cdC8vIFN0cmlwIHRhZ3MgYW5kIGNvbGxhcHNlIHdoaXRlc3BhY2UuIEtlZXAgcGFyYWdyYXBoIGJyZWFrcy5cclxuXHRjb25zdCB3aXRoQnJlYWtzID0gaHRtbFxyXG5cdFx0LnJlcGxhY2UoLzxcXC9wPlxccyo8cD4vZywgJ1xcblxcbicpXHJcblx0XHQucmVwbGFjZSgvPGJyXFxzKlxcLz8+L2csICdcXG4nKVxyXG5cdFx0LnJlcGxhY2UoLzxcXC9oXFxkPlxccyo8aFxcZFtePl0qPi9nLCAnXFxuXFxuJylcclxuXHRcdC5yZXBsYWNlKC88XFwvbGk+XFxzKjxsaT4vZywgJ1xcbicpXHJcblx0XHQucmVwbGFjZSgvPFxcLyh1bHxvbCk+L2csICdcXG5cXG4nKTtcclxuXHRjb25zdCBzdHJpcHBlZCA9IHdpdGhCcmVha3MucmVwbGFjZSgvPFtePl0rPi9nLCAnJyk7XHJcblx0cmV0dXJuIGRlY29kZUVudGl0aWVzKHN0cmlwcGVkKS5yZXBsYWNlKC9cXG57Myx9L2csICdcXG5cXG4nKS50cmltKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzbGljZUZpcnN0TldvcmRzKHRleHQ6IHN0cmluZywgd29yZExpbWl0OiBudW1iZXIpOiBzdHJpbmcge1xyXG5cdGNvbnN0IGxpbWl0ID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcih3b3JkTGltaXQpKTtcclxuXHRpZiAobGltaXQgPD0gMCkgcmV0dXJuICcnO1xyXG5cdGNvbnN0IHdvcmRzID0gKHRleHQgfHwgJycpLnRyaW0oKS5zcGxpdCgvXFxzKy9nKS5maWx0ZXIoQm9vbGVhbik7XHJcblx0aWYgKHdvcmRzLmxlbmd0aCA8PSBsaW1pdCkgcmV0dXJuIHdvcmRzLmpvaW4oJyAnKTtcclxuXHRyZXR1cm4gd29yZHMuc2xpY2UoMCwgbGltaXQpLmpvaW4oJyAnKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvdW50V29yZHModGV4dDogc3RyaW5nKTogbnVtYmVyIHtcclxuXHRyZXR1cm4gKHRleHQgfHwgJycpLnRyaW0oKS5zcGxpdCgvXFxzKy9nKS5maWx0ZXIoQm9vbGVhbikubGVuZ3RoO1xyXG59XHJcblxyXG5cclxuIl19