import { markdownToPlainText } from './ExportTextUtils';
function normalizeFolder(folder) {
    const f = folder.replace(/\\/g, '/').replace(/^\/+/, '').replace(/\/+$/, '');
    return f.length ? f : 'Exports';
}
function ensureRtfExt(name) {
    return name.toLowerCase().endsWith('.rtf') ? name : `${name}.rtf`;
}
function escapeRtfText(text) {
    return (text || '')
        .replace(/\\/g, '\\\\')
        .replace(/{/g, '\\{')
        .replace(/}/g, '\\}')
        .replace(/\r?\n/g, '\\par\n');
}
export class RtfExportService {
    constructor(vault) {
        this.vault = vault;
    }
    async export(params) {
        const folder = normalizeFolder(params.outputFolder);
        const fileName = ensureRtfExt(params.outputFileName);
        const outPath = `${folder}/${fileName}`.replace(/\/+/g, '/');
        // Simple manuscript-ish layout: 1-inch margins approximated by default, double-spaced via \sl.
        const parts = [];
        parts.push('{\\rtf1\\ansi\\deff0');
        parts.push('{\\fonttbl{\\f0 Times New Roman;}}');
        parts.push('\\fs24'); // 12pt
        parts.push('\\sl480\\slmult1'); // ~double-spaced
        const title = escapeRtfText(params.title || 'Untitled');
        const author = escapeRtfText(params.author || '');
        parts.push(`\\qc\\b ${title}\\b0\\par`);
        if (author)
            parts.push(`\\qc ${author}\\par`);
        parts.push('\\ql\\par\\par');
        for (const ch of params.chapters) {
            const chTitle = escapeRtfText(ch.title || 'Chapter');
            parts.push(`\\qc\\b ${chTitle}\\b0\\par`);
            parts.push('\\ql\\par');
            const body = markdownToPlainText(ch.markdown || '');
            parts.push(escapeRtfText(body));
            parts.push('\\par\\par');
        }
        parts.push('}');
        const rtf = parts.join('\n');
        // RTF is plain text; write via adapter.
        await this.vault.adapter.mkdir(folder).catch(() => { });
        await this.vault.adapter.write(outPath, rtf);
        return outPath;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUnRmRXhwb3J0U2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlJ0ZkV4cG9ydFNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFVeEQsU0FBUyxlQUFlLENBQUMsTUFBYztJQUN0QyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDN0UsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUNqQyxDQUFDO0FBRUQsU0FBUyxZQUFZLENBQUMsSUFBWTtJQUNqQyxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLE1BQU0sQ0FBQztBQUNuRSxDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsSUFBWTtJQUNsQyxPQUFPLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztTQUNqQixPQUFPLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQztTQUN0QixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQztTQUNwQixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQztTQUNwQixPQUFPLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ2hDLENBQUM7QUFFRCxNQUFNLE9BQU8sZ0JBQWdCO0lBRzVCLFlBQVksS0FBWTtRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBRUQsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUF1QjtRQUNuQyxNQUFNLE1BQU0sR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3BELE1BQU0sUUFBUSxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDckQsTUFBTSxPQUFPLEdBQUcsR0FBRyxNQUFNLElBQUksUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztRQUU3RCwrRkFBK0Y7UUFDL0YsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO1FBQzNCLEtBQUssQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNuQyxLQUFLLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDakQsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU87UUFDN0IsS0FBSyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCO1FBRWpELE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLFVBQVUsQ0FBQyxDQUFDO1FBQ3hELE1BQU0sTUFBTSxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ2xELEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxLQUFLLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLElBQUksTUFBTTtZQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxNQUFNLE9BQU8sQ0FBQyxDQUFDO1FBQzlDLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUU3QixLQUFLLE1BQU0sRUFBRSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNsQyxNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUMsRUFBRSxDQUFDLEtBQUssSUFBSSxTQUFTLENBQUMsQ0FBQztZQUNyRCxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsT0FBTyxXQUFXLENBQUMsQ0FBQztZQUMxQyxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxHQUFHLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLENBQUM7WUFDcEQsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNoQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFCLENBQUM7UUFFRCxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLE1BQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFN0Isd0NBQXdDO1FBQ3hDLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQUMsQ0FBQztRQUN2RCxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDN0MsT0FBTyxPQUFPLENBQUM7SUFDaEIsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBWYXVsdCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IG1hcmtkb3duVG9QbGFpblRleHQgfSBmcm9tICcuL0V4cG9ydFRleHRVdGlscyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXhwb3J0UnRmUGFyYW1zIHtcblx0dGl0bGU6IHN0cmluZztcblx0YXV0aG9yOiBzdHJpbmc7XG5cdGNoYXB0ZXJzOiBBcnJheTx7IHRpdGxlOiBzdHJpbmc7IG1hcmtkb3duOiBzdHJpbmc7IHNvdXJjZVBhdGg6IHN0cmluZyB9Pjtcblx0b3V0cHV0Rm9sZGVyOiBzdHJpbmc7XG5cdG91dHB1dEZpbGVOYW1lOiBzdHJpbmc7IC8vIHNob3VsZCBlbmQgd2l0aCAucnRmXG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUZvbGRlcihmb2xkZXI6IHN0cmluZyk6IHN0cmluZyB7XG5cdGNvbnN0IGYgPSBmb2xkZXIucmVwbGFjZSgvXFxcXC9nLCAnLycpLnJlcGxhY2UoL15cXC8rLywgJycpLnJlcGxhY2UoL1xcLyskLywgJycpO1xuXHRyZXR1cm4gZi5sZW5ndGggPyBmIDogJ0V4cG9ydHMnO1xufVxuXG5mdW5jdGlvbiBlbnN1cmVSdGZFeHQobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcblx0cmV0dXJuIG5hbWUudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLnJ0ZicpID8gbmFtZSA6IGAke25hbWV9LnJ0ZmA7XG59XG5cbmZ1bmN0aW9uIGVzY2FwZVJ0ZlRleHQodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcblx0cmV0dXJuICh0ZXh0IHx8ICcnKVxuXHRcdC5yZXBsYWNlKC9cXFxcL2csICdcXFxcXFxcXCcpXG5cdFx0LnJlcGxhY2UoL3svZywgJ1xcXFx7Jylcblx0XHQucmVwbGFjZSgvfS9nLCAnXFxcXH0nKVxuXHRcdC5yZXBsYWNlKC9cXHI/XFxuL2csICdcXFxccGFyXFxuJyk7XG59XG5cbmV4cG9ydCBjbGFzcyBSdGZFeHBvcnRTZXJ2aWNlIHtcblx0cHJpdmF0ZSByZWFkb25seSB2YXVsdDogVmF1bHQ7XG5cblx0Y29uc3RydWN0b3IodmF1bHQ6IFZhdWx0KSB7XG5cdFx0dGhpcy52YXVsdCA9IHZhdWx0O1xuXHR9XG5cblx0YXN5bmMgZXhwb3J0KHBhcmFtczogRXhwb3J0UnRmUGFyYW1zKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0XHRjb25zdCBmb2xkZXIgPSBub3JtYWxpemVGb2xkZXIocGFyYW1zLm91dHB1dEZvbGRlcik7XG5cdFx0Y29uc3QgZmlsZU5hbWUgPSBlbnN1cmVSdGZFeHQocGFyYW1zLm91dHB1dEZpbGVOYW1lKTtcblx0XHRjb25zdCBvdXRQYXRoID0gYCR7Zm9sZGVyfS8ke2ZpbGVOYW1lfWAucmVwbGFjZSgvXFwvKy9nLCAnLycpO1xuXG5cdFx0Ly8gU2ltcGxlIG1hbnVzY3JpcHQtaXNoIGxheW91dDogMS1pbmNoIG1hcmdpbnMgYXBwcm94aW1hdGVkIGJ5IGRlZmF1bHQsIGRvdWJsZS1zcGFjZWQgdmlhIFxcc2wuXG5cdFx0Y29uc3QgcGFydHM6IHN0cmluZ1tdID0gW107XG5cdFx0cGFydHMucHVzaCgne1xcXFxydGYxXFxcXGFuc2lcXFxcZGVmZjAnKTtcblx0XHRwYXJ0cy5wdXNoKCd7XFxcXGZvbnR0Ymx7XFxcXGYwIFRpbWVzIE5ldyBSb21hbjt9fScpO1xuXHRcdHBhcnRzLnB1c2goJ1xcXFxmczI0Jyk7IC8vIDEycHRcblx0XHRwYXJ0cy5wdXNoKCdcXFxcc2w0ODBcXFxcc2xtdWx0MScpOyAvLyB+ZG91YmxlLXNwYWNlZFxuXG5cdFx0Y29uc3QgdGl0bGUgPSBlc2NhcGVSdGZUZXh0KHBhcmFtcy50aXRsZSB8fCAnVW50aXRsZWQnKTtcblx0XHRjb25zdCBhdXRob3IgPSBlc2NhcGVSdGZUZXh0KHBhcmFtcy5hdXRob3IgfHwgJycpO1xuXHRcdHBhcnRzLnB1c2goYFxcXFxxY1xcXFxiICR7dGl0bGV9XFxcXGIwXFxcXHBhcmApO1xuXHRcdGlmIChhdXRob3IpIHBhcnRzLnB1c2goYFxcXFxxYyAke2F1dGhvcn1cXFxccGFyYCk7XG5cdFx0cGFydHMucHVzaCgnXFxcXHFsXFxcXHBhclxcXFxwYXInKTtcblxuXHRcdGZvciAoY29uc3QgY2ggb2YgcGFyYW1zLmNoYXB0ZXJzKSB7XG5cdFx0XHRjb25zdCBjaFRpdGxlID0gZXNjYXBlUnRmVGV4dChjaC50aXRsZSB8fCAnQ2hhcHRlcicpO1xuXHRcdFx0cGFydHMucHVzaChgXFxcXHFjXFxcXGIgJHtjaFRpdGxlfVxcXFxiMFxcXFxwYXJgKTtcblx0XHRcdHBhcnRzLnB1c2goJ1xcXFxxbFxcXFxwYXInKTtcblx0XHRcdGNvbnN0IGJvZHkgPSBtYXJrZG93blRvUGxhaW5UZXh0KGNoLm1hcmtkb3duIHx8ICcnKTtcblx0XHRcdHBhcnRzLnB1c2goZXNjYXBlUnRmVGV4dChib2R5KSk7XG5cdFx0XHRwYXJ0cy5wdXNoKCdcXFxccGFyXFxcXHBhcicpO1xuXHRcdH1cblxuXHRcdHBhcnRzLnB1c2goJ30nKTtcblx0XHRjb25zdCBydGYgPSBwYXJ0cy5qb2luKCdcXG4nKTtcblxuXHRcdC8vIFJURiBpcyBwbGFpbiB0ZXh0OyB3cml0ZSB2aWEgYWRhcHRlci5cblx0XHRhd2FpdCB0aGlzLnZhdWx0LmFkYXB0ZXIubWtkaXIoZm9sZGVyKS5jYXRjaCgoKSA9PiB7fSk7XG5cdFx0YXdhaXQgdGhpcy52YXVsdC5hZGFwdGVyLndyaXRlKG91dFBhdGgsIHJ0Zik7XG5cdFx0cmV0dXJuIG91dFBhdGg7XG5cdH1cbn1cblxuXG4iXX0=