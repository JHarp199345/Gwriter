import { markdownToPlainText } from './ExportTextUtils';
function normalizeFolder(folder) {
    const f = folder.replace(/\\/g, '/').replace(/^\/+/, '').replace(/\/+$/, '');
    return f.length ? f : 'Exports';
}
function ensureRtfExt(name) {
    return name.toLowerCase().endsWith('.rtf') ? name : `${name}.rtf`;
}
function escapeRtfText(text) {
    return (text || '')
        .replace(/\\/g, '\\\\')
        .replace(/{/g, '\\{')
        .replace(/}/g, '\\}')
        .replace(/\r?\n/g, '\\par\n');
}
export class RtfExportService {
    constructor(vault) {
        this.vault = vault;
    }
    async export(params) {
        const folder = normalizeFolder(params.outputFolder);
        const fileName = ensureRtfExt(params.outputFileName);
        const outPath = `${folder}/${fileName}`.replace(/\/+/g, '/');
        // Simple manuscript-ish layout: 1-inch margins approximated by default, double-spaced via \sl.
        const parts = [];
        parts.push('{\\rtf1\\ansi\\deff0');
        parts.push('{\\fonttbl{\\f0 Times New Roman;}}');
        parts.push('\\fs24'); // 12pt
        parts.push('\\sl480\\slmult1'); // ~double-spaced
        const title = escapeRtfText(params.title || 'Untitled');
        const author = escapeRtfText(params.author || '');
        parts.push(`\\qc\\b ${title}\\b0\\par`);
        if (author)
            parts.push(`\\qc ${author}\\par`);
        parts.push('\\ql\\par\\par');
        for (const ch of params.chapters) {
            const chTitle = escapeRtfText(ch.title || 'Chapter');
            parts.push(`\\qc\\b ${chTitle}\\b0\\par`);
            parts.push('\\ql\\par');
            const body = markdownToPlainText(ch.markdown || '');
            parts.push(escapeRtfText(body));
            parts.push('\\par\\par');
        }
        parts.push('}');
        const rtf = parts.join('\n');
        // RTF is plain text; write via adapter.
        await this.vault.adapter.mkdir(folder).catch(() => { });
        await this.vault.adapter.write(outPath, rtf);
        return outPath;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUnRmRXhwb3J0U2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlJ0ZkV4cG9ydFNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFVeEQsU0FBUyxlQUFlLENBQUMsTUFBYztJQUN0QyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDN0UsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUNqQyxDQUFDO0FBRUQsU0FBUyxZQUFZLENBQUMsSUFBWTtJQUNqQyxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLE1BQU0sQ0FBQztBQUNuRSxDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsSUFBWTtJQUNsQyxPQUFPLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztTQUNqQixPQUFPLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQztTQUN0QixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQztTQUNwQixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQztTQUNwQixPQUFPLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ2hDLENBQUM7QUFFRCxNQUFNLE9BQU8sZ0JBQWdCO0lBRzVCLFlBQVksS0FBWTtRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBRUQsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUF1QjtRQUNuQyxNQUFNLE1BQU0sR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3BELE1BQU0sUUFBUSxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDckQsTUFBTSxPQUFPLEdBQUcsR0FBRyxNQUFNLElBQUksUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztRQUU3RCwrRkFBK0Y7UUFDL0YsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO1FBQzNCLEtBQUssQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNuQyxLQUFLLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDakQsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU87UUFDN0IsS0FBSyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCO1FBRWpELE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLFVBQVUsQ0FBQyxDQUFDO1FBQ3hELE1BQU0sTUFBTSxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ2xELEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxLQUFLLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLElBQUksTUFBTTtZQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxNQUFNLE9BQU8sQ0FBQyxDQUFDO1FBQzlDLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUU3QixLQUFLLE1BQU0sRUFBRSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNsQyxNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUMsRUFBRSxDQUFDLEtBQUssSUFBSSxTQUFTLENBQUMsQ0FBQztZQUNyRCxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsT0FBTyxXQUFXLENBQUMsQ0FBQztZQUMxQyxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxHQUFHLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLENBQUM7WUFDcEQsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNoQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFCLENBQUM7UUFFRCxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLE1BQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFN0Isd0NBQXdDO1FBQ3hDLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQUMsQ0FBQztRQUN2RCxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDN0MsT0FBTyxPQUFPLENBQUM7SUFDaEIsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBWYXVsdCB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgbWFya2Rvd25Ub1BsYWluVGV4dCB9IGZyb20gJy4vRXhwb3J0VGV4dFV0aWxzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRXhwb3J0UnRmUGFyYW1zIHtcclxuXHR0aXRsZTogc3RyaW5nO1xyXG5cdGF1dGhvcjogc3RyaW5nO1xyXG5cdGNoYXB0ZXJzOiBBcnJheTx7IHRpdGxlOiBzdHJpbmc7IG1hcmtkb3duOiBzdHJpbmc7IHNvdXJjZVBhdGg6IHN0cmluZyB9PjtcclxuXHRvdXRwdXRGb2xkZXI6IHN0cmluZztcclxuXHRvdXRwdXRGaWxlTmFtZTogc3RyaW5nOyAvLyBzaG91bGQgZW5kIHdpdGggLnJ0ZlxyXG59XHJcblxyXG5mdW5jdGlvbiBub3JtYWxpemVGb2xkZXIoZm9sZGVyOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdGNvbnN0IGYgPSBmb2xkZXIucmVwbGFjZSgvXFxcXC9nLCAnLycpLnJlcGxhY2UoL15cXC8rLywgJycpLnJlcGxhY2UoL1xcLyskLywgJycpO1xyXG5cdHJldHVybiBmLmxlbmd0aCA/IGYgOiAnRXhwb3J0cyc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGVuc3VyZVJ0ZkV4dChuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdHJldHVybiBuYW1lLnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgoJy5ydGYnKSA/IG5hbWUgOiBgJHtuYW1lfS5ydGZgO1xyXG59XHJcblxyXG5mdW5jdGlvbiBlc2NhcGVSdGZUZXh0KHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XHJcblx0cmV0dXJuICh0ZXh0IHx8ICcnKVxyXG5cdFx0LnJlcGxhY2UoL1xcXFwvZywgJ1xcXFxcXFxcJylcclxuXHRcdC5yZXBsYWNlKC97L2csICdcXFxceycpXHJcblx0XHQucmVwbGFjZSgvfS9nLCAnXFxcXH0nKVxyXG5cdFx0LnJlcGxhY2UoL1xccj9cXG4vZywgJ1xcXFxwYXJcXG4nKTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFJ0ZkV4cG9ydFNlcnZpY2Uge1xyXG5cdHByaXZhdGUgcmVhZG9ubHkgdmF1bHQ6IFZhdWx0O1xyXG5cclxuXHRjb25zdHJ1Y3Rvcih2YXVsdDogVmF1bHQpIHtcclxuXHRcdHRoaXMudmF1bHQgPSB2YXVsdDtcclxuXHR9XHJcblxyXG5cdGFzeW5jIGV4cG9ydChwYXJhbXM6IEV4cG9ydFJ0ZlBhcmFtcyk6IFByb21pc2U8c3RyaW5nPiB7XHJcblx0XHRjb25zdCBmb2xkZXIgPSBub3JtYWxpemVGb2xkZXIocGFyYW1zLm91dHB1dEZvbGRlcik7XHJcblx0XHRjb25zdCBmaWxlTmFtZSA9IGVuc3VyZVJ0ZkV4dChwYXJhbXMub3V0cHV0RmlsZU5hbWUpO1xyXG5cdFx0Y29uc3Qgb3V0UGF0aCA9IGAke2ZvbGRlcn0vJHtmaWxlTmFtZX1gLnJlcGxhY2UoL1xcLysvZywgJy8nKTtcclxuXHJcblx0XHQvLyBTaW1wbGUgbWFudXNjcmlwdC1pc2ggbGF5b3V0OiAxLWluY2ggbWFyZ2lucyBhcHByb3hpbWF0ZWQgYnkgZGVmYXVsdCwgZG91YmxlLXNwYWNlZCB2aWEgXFxzbC5cclxuXHRcdGNvbnN0IHBhcnRzOiBzdHJpbmdbXSA9IFtdO1xyXG5cdFx0cGFydHMucHVzaCgne1xcXFxydGYxXFxcXGFuc2lcXFxcZGVmZjAnKTtcclxuXHRcdHBhcnRzLnB1c2goJ3tcXFxcZm9udHRibHtcXFxcZjAgVGltZXMgTmV3IFJvbWFuO319Jyk7XHJcblx0XHRwYXJ0cy5wdXNoKCdcXFxcZnMyNCcpOyAvLyAxMnB0XHJcblx0XHRwYXJ0cy5wdXNoKCdcXFxcc2w0ODBcXFxcc2xtdWx0MScpOyAvLyB+ZG91YmxlLXNwYWNlZFxyXG5cclxuXHRcdGNvbnN0IHRpdGxlID0gZXNjYXBlUnRmVGV4dChwYXJhbXMudGl0bGUgfHwgJ1VudGl0bGVkJyk7XHJcblx0XHRjb25zdCBhdXRob3IgPSBlc2NhcGVSdGZUZXh0KHBhcmFtcy5hdXRob3IgfHwgJycpO1xyXG5cdFx0cGFydHMucHVzaChgXFxcXHFjXFxcXGIgJHt0aXRsZX1cXFxcYjBcXFxccGFyYCk7XHJcblx0XHRpZiAoYXV0aG9yKSBwYXJ0cy5wdXNoKGBcXFxccWMgJHthdXRob3J9XFxcXHBhcmApO1xyXG5cdFx0cGFydHMucHVzaCgnXFxcXHFsXFxcXHBhclxcXFxwYXInKTtcclxuXHJcblx0XHRmb3IgKGNvbnN0IGNoIG9mIHBhcmFtcy5jaGFwdGVycykge1xyXG5cdFx0XHRjb25zdCBjaFRpdGxlID0gZXNjYXBlUnRmVGV4dChjaC50aXRsZSB8fCAnQ2hhcHRlcicpO1xyXG5cdFx0XHRwYXJ0cy5wdXNoKGBcXFxccWNcXFxcYiAke2NoVGl0bGV9XFxcXGIwXFxcXHBhcmApO1xyXG5cdFx0XHRwYXJ0cy5wdXNoKCdcXFxccWxcXFxccGFyJyk7XHJcblx0XHRcdGNvbnN0IGJvZHkgPSBtYXJrZG93blRvUGxhaW5UZXh0KGNoLm1hcmtkb3duIHx8ICcnKTtcclxuXHRcdFx0cGFydHMucHVzaChlc2NhcGVSdGZUZXh0KGJvZHkpKTtcclxuXHRcdFx0cGFydHMucHVzaCgnXFxcXHBhclxcXFxwYXInKTtcclxuXHRcdH1cclxuXHJcblx0XHRwYXJ0cy5wdXNoKCd9Jyk7XHJcblx0XHRjb25zdCBydGYgPSBwYXJ0cy5qb2luKCdcXG4nKTtcclxuXHJcblx0XHQvLyBSVEYgaXMgcGxhaW4gdGV4dDsgd3JpdGUgdmlhIGFkYXB0ZXIuXHJcblx0XHRhd2FpdCB0aGlzLnZhdWx0LmFkYXB0ZXIubWtkaXIoZm9sZGVyKS5jYXRjaCgoKSA9PiB7fSk7XHJcblx0XHRhd2FpdCB0aGlzLnZhdWx0LmFkYXB0ZXIud3JpdGUob3V0UGF0aCwgcnRmKTtcclxuXHRcdHJldHVybiBvdXRQYXRoO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbiJdfQ==